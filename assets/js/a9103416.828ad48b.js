"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2206],{56379:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>c,frontMatter:()=>n,metadata:()=>i,toc:()=>p});var l=a(87462),r=(a(67294),a(3905));const n={sidebar_position:2,title:"Helm"},o=void 0,i={unversionedId:"get-started/helm",id:"get-started/helm",title:"Helm",description:"Helm chart for Valkyrie",source:"@site/docs/get-started/helm.md",sourceDirName:"get-started",slug:"/get-started/helm",permalink:"/docs/get-started/helm",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"Helm"},sidebar:"defaultSidebar",previous:{title:"Docker",permalink:"/docs/get-started/docker"},next:{title:"Configuration",permalink:"/docs/get-started/configuration"}},s={},p=[{value:"Helm chart for Valkyrie",id:"helm-chart-for-valkyrie",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Using GCP for surrounding features",id:"using-gcp-for-surrounding-features",level:2},{value:"Install",id:"install",level:2},{value:"Packaging",id:"packaging",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2}],u={toc:p};function c(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,l.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"helm-chart-for-valkyrie"},"Helm chart for Valkyrie"),(0,r.kt)("p",null,"Helm is a package manager for Kubernetes. For basic usage and installation please refer to ",(0,r.kt)("a",{parentName:"p",href:"https://helm.sh/"},"https://helm.sh/"),"."),(0,r.kt)("h2",{id:"configuration"},"Configuration"),(0,r.kt)("p",null,"This is a sample configuration. For a more extensive example refer to ",(0,r.kt)("a",{parentName:"p",href:"./configuration"},"Configuration")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"  config:\n    logging:\n      level: info\n    pam:\n      name: generic\n      api_key: ${PAM_API_KEY}\n      url: 'https://api.your.pam'\n    providers:\n      - name: some_provider\n        url: 'https://api.some.provider'\n        auth:\n          api_key: ${SOME_PROVIDER_API_TOKEN}\n  env:\n    - name: SOME_PROVIDER_API_TOKEN\n      valueFrom:\n        secretKeyRef:\n          name: 'the-secret-your-created'\n          key: some-provider-api-token\n")),(0,r.kt)("p",null,"In order to provide external access to the valkyrie service a few things will be needed which are\ndependent on the environment:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"domain names and SSL certificates"),(0,r.kt)("li",{parentName:"ul"},"most likely some sort of IP whitelisting for each provider"),(0,r.kt)("li",{parentName:"ul"},"NAT gateway for egress Valkyrie traffic providing a static IP for provider whitelisting")),(0,r.kt)("h2",{id:"using-gcp-for-surrounding-features"},"Using GCP for surrounding features"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"SSL: ",(0,r.kt)("a",{parentName:"li",href:"https://cloud.google.com/kubernetes-engine/docs/how-to/managed-certs"},"google-managed ssl for GKE")),(0,r.kt)("li",{parentName:"ol"},"IP whitelisting: ",(0,r.kt)("a",{parentName:"li",href:"https://cloud.google.com/kubernetes-engine/docs/how-to/ingress-features#cloud_armor"},"Google Cloud Armor Ingress security policy")),(0,r.kt)("li",{parentName:"ol"},"Static IP for outgoing traffic: ",(0,r.kt)("a",{parentName:"li",href:"https://cloud.google.com/nat/docs/gke-example"},"Set up Cloud NAT with GKE"))),(0,r.kt)("h2",{id:"install"},"Install"),(0,r.kt)("p",null,"Show the supported values that can be configured:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"helm show values path/to/helm\n")),(0,r.kt)("p",null,"Simulate an install using the ",(0,r.kt)("inlineCode",{parentName:"p"},"--dry-run")," flag and provide a few explicit values:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"helm install my-valkyrie path/to/helm --set image.repository=<container repo> --set image.tag=<version> --dry-run\n")),(0,r.kt)("p",null,"Install using a user provided values file (",(0,r.kt)("inlineCode",{parentName:"p"},"-f <valuesfile>"),"):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"helm install my-valkyrie path/to/helm -f <values-file>\n")),(0,r.kt)("h2",{id:"packaging"},"Packaging"),(0,r.kt)("p",null,"Package the chart:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"helm package path/to/helm\n")),(0,r.kt)("p",null,"Push the packaged chart to repo:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"helm push valkyrie-chart-0.1.0.tgz oci://oci-repo\n")),(0,r.kt)("p",null,"You can now access the chart using the OCI registry:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"helm show readme oci://oci-repo/valkyrie-chart\n")),(0,r.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,r.kt)("p",null,"Render the k8s resources produced by the chart:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"helm template path/to/helm --debug\n")))}c.isMDXComponent=!0}}]);