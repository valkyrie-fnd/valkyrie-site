"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2206],{56379:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>s,contentTitle:()=>i,default:()=>c,frontMatter:()=>r,metadata:()=>o,toc:()=>u});var l=t(87462),n=(t(67294),t(3905));const r={sidebar_position:4,title:"Helm"},i=void 0,o={unversionedId:"get-started/helm",id:"get-started/helm",title:"Helm",description:"Helm chart for Valkyrie",source:"@site/docs/get-started/helm.md",sourceDirName:"get-started",slug:"/get-started/helm",permalink:"/docs/get-started/helm",draft:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4,title:"Helm"},sidebar:"defaultSidebar",previous:{title:"Docker",permalink:"/docs/get-started/docker"},next:{title:"Player Account Management",permalink:"/docs/get-started/pam"}},s={},u=[{value:"Helm chart for Valkyrie",id:"helm-chart-for-valkyrie",level:2},{value:"Getting started",id:"getting-started",level:3},{value:"Tutorial: installing your first Valkyrie using Helm",id:"tutorial-installing-your-first-valkyrie-using-helm",level:4},{value:"Chart configuration",id:"chart-configuration",level:3},{value:"Application config",id:"application-config",level:4},{value:"Secrets",id:"secrets",level:4},{value:"Cloud provider configuration",id:"cloud-provider-configuration",level:3},{value:"Using GCP for surrounding features",id:"using-gcp-for-surrounding-features",level:4}],p={toc:u};function c(e){let{components:a,...t}=e;return(0,n.kt)("wrapper",(0,l.Z)({},p,t,{components:a,mdxType:"MDXLayout"}),(0,n.kt)("h2",{id:"helm-chart-for-valkyrie"},"Helm chart for Valkyrie"),(0,n.kt)("p",null,"Helm is a package manager for Kubernetes. For basic usage and installation please refer to the official ",(0,n.kt)("a",{parentName:"p",href:"https://helm.sh/docs/intro/quickstart/"},"quickstart guide"),"."),(0,n.kt)("h3",{id:"getting-started"},"Getting started"),(0,n.kt)("p",null,"The Valkyrie Helm chart is available on ",(0,n.kt)("a",{parentName:"p",href:"https://hub.docker.com/r/valkyriefnd/valkyrie-chart"},"Docker Hub")," and can be\ninstalled from there directly by Helm:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"helm install valkyrie oci://docker.io/valkyriefnd/valkyrie-chart -v values.yaml\n")),(0,n.kt)("p",null,"The above command will install Valkyrie in the current Kubernetes cluster according to the configuration specified in\n",(0,n.kt)("inlineCode",{parentName:"p"},"values.yaml"),"."),(0,n.kt)("p",null,"For a more detailed example please follow the tutorial below."),(0,n.kt)("h4",{id:"tutorial-installing-your-first-valkyrie-using-helm"},"Tutorial: installing your first Valkyrie using Helm"),(0,n.kt)("p",null,"The following command will install Valkyrie in your currently configured Kubernetes cluster:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"helm upgrade --install my-valkyrie             \\\n    oci://docker.io/valkyriefnd/valkyrie-chart \\\n    -n playground-valkyrie --create-namespace\n")),(0,n.kt)("p",null,"Let's break down the above command:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"It will upgrade (or install if missing) a Helm ",(0,n.kt)("em",{parentName:"li"},"release")," called ",(0,n.kt)("inlineCode",{parentName:"li"},"my-valkyrie")),(0,n.kt)("li",{parentName:"ol"},"The chart will be pulled from ",(0,n.kt)("inlineCode",{parentName:"li"},"oci://docker.io/valkyriefnd/valkyrie-chart")),(0,n.kt)("li",{parentName:"ol"},"The ",(0,n.kt)("em",{parentName:"li"},"release")," will be installed into ",(0,n.kt)("inlineCode",{parentName:"li"},"playground-valkyrie")," Kubernetes namespace (creating the namespace if missing)")),(0,n.kt)("p",null,"Helm can now be used to manage this ",(0,n.kt)("em",{parentName:"p"},"release"),". Try listing the release using Helm:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"helm list -n playground-valkyrie\n")),(0,n.kt)("p",null,"You should now see the release listed by Helm."),(0,n.kt)("p",null,"In a real scenario you will want to further configure Valkyrie with a ",(0,n.kt)("em",{parentName:"p"},"pam")," and one or more ",(0,n.kt)("em",{parentName:"p"},"providers"),".\nFor the sake of learning, let's upgrade our ",(0,n.kt)("em",{parentName:"p"},"release")," ",(0,n.kt)("inlineCode",{parentName:"p"},"my-valkyrie")," and change the configured logging level:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},'helm upgrade my-valkyrie                       \\\n    oci://docker.io/valkyriefnd/valkyrie-chart \\\n    --set "config.logging.level=debug"\n    -n playground-valkyrie\n')),(0,n.kt)("p",null,"This should upgrade to a new revision of our ",(0,n.kt)("em",{parentName:"p"},"release")," ",(0,n.kt)("inlineCode",{parentName:"p"},"my-valkyrie")," with the ",(0,n.kt)("em",{parentName:"p"},"value")," ",(0,n.kt)("inlineCode",{parentName:"p"},"config.logging.level")," set to ",(0,n.kt)("inlineCode",{parentName:"p"},"debug"),",\noverriding the default logging level (",(0,n.kt)("inlineCode",{parentName:"p"},"info"),")."),(0,n.kt)("p",null,"You can also simulate an upgrade using the ",(0,n.kt)("inlineCode",{parentName:"p"},"--dry-run")," flag:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"helm upgrade my-valkyrie oci://docker.io/valkyriefnd/valkyrie-chart \\\n    -n playground-valkyrie --dry-run\n")),(0,n.kt)("p",null,"This will output the produced kubernetes manifests that would be applied by Helm."),(0,n.kt)("p",null,"To further configure the chart, please refer to the ",(0,n.kt)("a",{parentName:"p",href:"#chart-configuration"},"Chart configuration")," section below."),(0,n.kt)("p",null,"Finally, lets cleanup after ourselves by uninstalling the ",(0,n.kt)("em",{parentName:"p"},"release"),":"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"helm uninstall my-valkyrie -n playground-valkyrie\n")),(0,n.kt)("p",null,"This will remove all resources in Kubernetes related to the ",(0,n.kt)("em",{parentName:"p"},"release"),"."),(0,n.kt)("h3",{id:"chart-configuration"},"Chart configuration"),(0,n.kt)("p",null,"Helm charts are configured by supplying ",(0,n.kt)("em",{parentName:"p"},"values"),", typically by a ",(0,n.kt)("em",{parentName:"p"},"values.yaml"),"-file."),(0,n.kt)("p",null,"The chart ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/valkyrie-fnd/valkyrie/blob/main/helm/values.yaml"},"values.yaml")," can be found in the Valkyrie repository on GitHub.\nThis file has all the default values for the Helm chart, but also includes commented parts with example configuration for reference."),(0,n.kt)("admonition",{type:"note"},(0,n.kt)("p",{parentName:"admonition"},"You can also show the chart values using the command:"),(0,n.kt)("pre",{parentName:"admonition"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"helm show values oci://docker.io/valkyriefnd/valkyrie-chart\n"))),(0,n.kt)("p",null,"Custom values are typically provided to Helm using the ",(0,n.kt)("inlineCode",{parentName:"p"},"-v <values.yaml>")," flag when running the ",(0,n.kt)("inlineCode",{parentName:"p"},"helm upgrade")," command."),(0,n.kt)("h4",{id:"application-config"},"Application config"),(0,n.kt)("p",null,"To configure the Valkyrie application (previously described in ",(0,n.kt)("a",{parentName:"p",href:"./configuration"},"Configuration")," section) the ",(0,n.kt)("inlineCode",{parentName:"p"},"config")," key is available. Everything configured under the ",(0,n.kt)("inlineCode",{parentName:"p"},"config")," key will\nbe available to the running application."),(0,n.kt)("p",null,"Below is a small sample:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-yaml"},"config:\n  logging:\n    level: debug\n")),(0,n.kt)("p",null,"In the example above, the key ",(0,n.kt)("inlineCode",{parentName:"p"},"logging.level=debug")," will be configured for the Valkyrie application."),(0,n.kt)("h4",{id:"secrets"},"Secrets"),(0,n.kt)("p",null,"A common use case is to configure a secret for the Valkyrie application (for example an API token).\nThe recommendation is to configure the secret value using a ",(0,n.kt)("inlineCode",{parentName:"p"},"Secret")," resource in Kubernetes, please refer to the\nofficial Kubernetes ",(0,n.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/configuration/secret/"},"Secret documentation")," for this."),(0,n.kt)("p",null,"Once the secret has been configured as a ",(0,n.kt)("inlineCode",{parentName:"p"},"Secret")," resource, you may refer to the resource name from the Helm chart\nconfiguration. We recommend that you use the ",(0,n.kt)("inlineCode",{parentName:"p"},"env")," key in the Helm chart, which allows the secret to be placed into\nan environment variable for the running container."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-yaml"},"env:\n  - name: SOME_PROVIDER_API_TOKEN\n    valueFrom:\n      secretKeyRef:\n        name: 'the-secret-your-created'\n        key: some-provider-api-token\n")),(0,n.kt)("p",null,"You may then reference the environment variable in the application configuration safely without leaking the secret:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-yaml"},"config:\n  providers:\n    - name: some_provider\n      url: 'https://api.some.provider'\n      auth:\n        api_key: ${SOME_PROVIDER_API_TOKEN}\n")),(0,n.kt)("h3",{id:"cloud-provider-configuration"},"Cloud provider configuration"),(0,n.kt)("p",null,"In order to provide external access to the valkyrie service a few things will be needed which are\ndependent on the environment:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"domain names and SSL certificates"),(0,n.kt)("li",{parentName:"ul"},"most likely some sort of IP whitelisting for each provider"),(0,n.kt)("li",{parentName:"ul"},"NAT gateway for egress Valkyrie traffic providing a static IP for provider whitelisting")),(0,n.kt)("h4",{id:"using-gcp-for-surrounding-features"},"Using GCP for surrounding features"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"SSL: ",(0,n.kt)("a",{parentName:"li",href:"https://cloud.google.com/kubernetes-engine/docs/how-to/managed-certs"},"google-managed ssl for GKE")),(0,n.kt)("li",{parentName:"ol"},"IP whitelisting: ",(0,n.kt)("a",{parentName:"li",href:"https://cloud.google.com/kubernetes-engine/docs/how-to/ingress-features#cloud_armor"},"Google Cloud Armor Ingress security policy")),(0,n.kt)("li",{parentName:"ol"},"Static IP for outgoing traffic: ",(0,n.kt)("a",{parentName:"li",href:"https://cloud.google.com/nat/docs/gke-example"},"Set up Cloud NAT with GKE"))))}c.isMDXComponent=!0}}]);